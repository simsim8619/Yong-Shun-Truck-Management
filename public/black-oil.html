// public/assets/js/blackOil.js - 前端请求后端接口
// 你的 Vercel 域名，替换成实际的
const BASE_URL = 'https://xxx.vercel.app/api/blackOil';

// 1. 车牌校验
async function checkPlate(plate, lang) {
  const res = await fetch(BASE_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'checkPlate', plate, lang })
  });
  const data = await res.json();
  alert(data.msg);
  return data.valid;
}

// 2. 里程计算+预警
async function calcMileage(total, consumption, lang) {
  const res = await fetch(BASE_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'calcMileage', total_mileage: total, consumption_mileage: consumption, lang })
  });
  const data = await res.json();
  if (data.code === 0) {
    // 渲染预警信息和标色（对应原 VBA 单元格标色）
    document.getElementById('alert-msg').innerText = data.data.alertMsg;
    document.getElementById('mileage-card').style.backgroundColor = data.data.color;
  } else {
    alert(data.msg);
  }
}

// 3. 保存数据
async function saveData(formData, lang) {
  const res = await fetch(BASE_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'saveData', ...formData })
  });
  const data = await res.json();
  alert(data.msg);
  if (data.code === 0) location.reload(); // 保存成功刷新页面
}