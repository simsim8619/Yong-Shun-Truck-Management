<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gear Oil Management</title>
  <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
  <div class="header">
    <h1 data-lang="gearOil">齿轮油管理</h1>
    <div class="lang-switch">
      <button onclick="switchLang('zh')">中文</button>
      <button onclick="switchLang('en')">English</button>
    </div>
  </div>

  <div class="form-container">
    <div class="form-group">
      <label data-lang="plate" for="plate"></label>
      <input type="text" id="plate" placeholder="请输入车牌">
      <button onclick="checkPlate()" style="margin-top: 10px;" data-lang="checkPlate"></button>
    </div>

    <div class="form-group">
      <label data-lang="totalMileage" for="totalMileage"></label>
      <input type="number" id="totalMileage" placeholder="请输入总里程" min="0">
    </div>

    <div class="form-group">
      <label data-lang="consumptionMileage" for="consumptionMileage"></label>
      <input type="number" id="consumptionMileage" placeholder="请输入消耗里程" min="0">
    </div>

    <div class="form-group">
      <label data-lang="maintainDate" for="maintainDate"></label>
      <input type="date" id="maintainDate">
    </div>

    <button class="btn-submit" onclick="calcMileage()" data-lang="calcMileage"></button>
    <button class="btn-submit" onclick="saveData()" style="margin-top: 10px;" data-lang="saveData"></button>
  </div>

  <div id="result" class="result"></div>

  <a href="index.html" class="btn-back" data-lang="back"></a>

  <script src="./assets/js/common.js"></script>
  <script>
    // 校验车牌
    async function checkPlate() {
      const plate = document.getElementById("plate").value.trim();
      if (!plate) return alert(langDict[currentLang].plateEmpty);
      const res = await requestApi("/gearOil", "POST", { action: "checkPlate", plate });
      alert(res.msg);
    }

    // 计算预警
    async function calcMileage() {
      const plate = document.getElementById("plate").value.trim();
      const total = document.getElementById("totalMileage").value;
      const consumption = document.getElementById("consumptionMileage").value;
      if (!plate) return alert(langDict[currentLang].plateEmpty);
      if (!total || !consumption) return alert(langDict[currentLang].mileagePositive);
      
      const res = await requestApi("/gearOil", "POST", {
        action: "calcMileage",
        plate,
        total_mileage: total,
        consumption_mileage: consumption
      });
      if (res.code === 0) {
        const resultEl = document.getElementById("result");
        resultEl.textContent = res.data.alertMsg;
        resultEl.className = `result ${res.data.color}`;
      } else {
        alert(res.msg);
      }
    }

    // 保存数据
    async function saveData() {
      const plate = document.getElementById("plate").value.trim();
      const total = document.getElementById("totalMileage").value;
      const consumption = document.getElementById("consumptionMileage").value;
      const date = document.getElementById("maintainDate").value;
      if (!plate || !date) return alert(langDict[currentLang].plateEmpty + " / " + langDict[currentLang].dateEmpty);
      if (!total || !consumption) return alert(langDict[currentLang].mileagePositive);
      
      const res = await requestApi("/gearOil", "POST", {
        action: "saveData",
        plate,
        total_mileage: total,
        consumption_mileage: consumption,
        maintain_date: date
      });
      alert(res.msg);
      if (res.code === 0) window.location.reload();
    }
  </script>
</body>
</html>